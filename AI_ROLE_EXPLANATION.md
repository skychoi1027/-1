# AI API의 역할 설명

## 전체 프로세스 흐름

```
1. 사용자 입력 (이름, 생년월일, 생시, 성별)
   ↓
2. 사주 계산 (프론트엔드에서 수행)
   - sajuCalculator.ts에서 계산
   - 궁합 점수 계산 (0-100점)
   - 살(煞) 분석 (충살, 형살, 파살 등)
   - 오행 분석 (상생/상극)
   ↓
3. 계산 결과 표시
   - 점수, 사주 정보, 그래프 표시
   ↓
4. AI 조언 요청 (사용자가 버튼 클릭)
   - 이미 계산된 결과를 AI에게 전달
   - AI가 결과를 해석하여 조언 생성
```

## AI API가 하는 일

### ✅ AI API의 역할

**AI는 계산된 결과를 해석하고 조언을 제공합니다.**

1. **계산 결과 해석**
   - 예: "75점, 충살 2개, 형살 1개" → 이 의미를 설명
   
2. **자연어 조언 생성**
   - 계산 결과를 바탕으로 실용적인 조언 생성
   - 예: "무난한 궁합입니다. 서로의 차이점을 인정하고..."
   
3. **구체적인 팁 제공**
   - 관계 개선을 위한 구체적인 방법 제시
   - 예: "서로의 말을 경청하고 상대방의 입장을 이해하려 노력하세요."

### ❌ AI API가 하지 않는 일

1. **사주 계산 자체**
   - 사주 계산은 `sajuCalculator.ts`에서 이미 완료됨
   - AI는 계산 결과만 받음

2. **점수 계산**
   - 점수는 이미 계산되어 있음
   - AI는 점수의 의미만 해석

## 실제 예시

### 입력 데이터 (AI에게 전달되는 것)

```typescript
{
  score: 75,                    // 이미 계산된 점수
  explanation: "무난한 궁합입니다...",  // 이미 생성된 설명
  salAnalysis: [                 // 이미 분석된 살
    { type: "충살", count: 2, description: "..." },
    { type: "형살", count: 1, description: "..." }
  ],
  user1: { name: "홍길동", gender: "남", ... },
  user2: { name: "김영희", gender: "여", ... },
  saju1: { year: {gan: "갑", ji: "자"}, ... },
  saju2: { year: {gan: "을", ji: "축"}, ... }
}
```

### AI가 생성하는 조언

```
"홍길동님과 김영희님의 궁합은 75점으로 무난한 수준입니다. 
충살이 2개 발견되어 서로의 성향이 다를 수 있지만, 
이것은 오히려 서로를 보완할 수 있는 기회가 될 수 있습니다.

구체적인 조언:
1. 서로의 차이점을 인정하고 이해하려는 노력을 기울이세요.
2. 갈등이 생겼을 때는 감정보다 사실에 집중하여 대화하세요.
3. 공통 관심사를 찾아 함께 즐기는 시간을 늘려보세요."
```

## 왜 AI를 사용하나요?

### 기본 조언 vs AI 조언

**기본 조언 (getDefaultAdvice 함수):**
- 점수 구간별로 미리 작성된 고정된 조언
- 예: 75점 → 항상 같은 조언

**AI 조언:**
- 계산된 결과를 바탕으로 개인화된 조언
- 예: 75점이지만 충살 2개, 형살 1개 → "충살이 많으므로..." 같은 맞춤 조언
- 사용자 이름, 성별, 사주 정보를 종합하여 더 구체적인 조언

## 코드에서 확인하기

### AI가 받는 데이터
```typescript
// app/ai-advice.tsx에서
const adviceData = await getAIAdvice({
  score: compatibilityResult.score,          // 이미 계산됨
  explanation: compatibilityResult.explanation,  // 이미 생성됨
  salAnalysis: compatibilityResult.salAnalysis,  // 이미 분석됨
  user1, user2, saju1, saju2                 // 원본 데이터
});
```

### AI가 생성하는 프롬프트
```typescript
// utils/aiService.ts의 generatePrompt 함수
let prompt = `다음 사주 궁합 결과를 분석하여 조언을 해주세요:
궁합 점수: 75점
설명: 무난한 궁합입니다.
감점 요소 (살):
- 충살: 2개 (...)
- 형살: 1개 (...)
이용자 정보:
- 홍길동 (남)
- 김영희 (여)
...`;
```

### AI 응답
```
"홍길동님과 김영희님의 궁합을 분석해보니..."
(자연어로 작성된 개인화된 조언)
```

## 요약

| 항목 | 위치 | 역할 |
|------|------|------|
| **사주 계산** | `sajuCalculator.ts` | 점수, 살 분석 계산 |
| **AI 조언** | `aiService.ts` | 계산 결과 해석 및 조언 생성 |
| **결과 표시** | `app/result.tsx` | 점수, 그래프 표시 |
| **AI 조언 표시** | `app/ai-advice.tsx` | AI가 생성한 조언 표시 |

**AI API는 "해석자" 역할을 합니다!**
- 계산은 이미 완료됨
- AI는 그 결과를 읽고 이해하기 쉽게 설명해줌

