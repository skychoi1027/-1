# 백엔드 서버 상세 설명

## 🎯 백엔드 서버란?

백엔드 서버는 **프론트엔드(앱/웹)와 외부 서비스(OpenAI 등) 사이의 중간 서버**입니다.

### 위치
- 파일: `backend/server.js`
- 포트: `http://localhost:3000` (기본값)
- 기술: Node.js + Express

---

## 🔄 데이터 흐름

### AI 조언 기능 예시

```
[사용자] → [프론트엔드 앱] → [백엔드 서버] → [OpenAI API]
                                      ↓
                              [AI 조언 생성]
                                      ↓
[사용자] ← [프론트엔드 앱] ← [백엔드 서버] ← [AI 응답]
```

### 실제 예시

1. **사용자가 "AI 조언 받기" 버튼 클릭**
   - 프론트엔드: 궁합 결과 데이터 수집

2. **프론트엔드 → 백엔드 요청**
   ```javascript
   POST http://localhost:3000/api/ai-advice
   {
     "score": 75,
     "explanation": "무난한 궁합입니다.",
     "salAnalysis": [
       {"type": "충살", "count": 1, "description": "..."}
     ],
     "user1": {...},
     "user2": {...}
   }
   ```

3. **백엔드 서버 처리**
   - 입력값 검증
   - OpenAI API 키 사용 (서버에서만)
   - OpenAI에 프롬프트 전송
   - AI 응답 받기

4. **백엔드 → 프론트엔드 응답**
   ```json
   {
     "success": true,
     "data": {
       "advice": "두 분의 궁합은...",
       "tips": ["소통을 자주 하세요", "서로를 존중하세요"],
       "summary": "무난한 궁합입니다."
     }
   }
   ```

5. **프론트엔드: 화면에 조언 표시**

---

## 🛡️ 백엔드가 필요한 이유

### 1. 보안 (가장 중요!)

**❌ 백엔드 없이 (위험)**
```
프론트엔드 → OpenAI API (직접)
            ↑
      API 키가 브라우저에 노출됨!
      (개발자 도구에서 볼 수 있음)
```

**✅ 백엔드 사용 (안전)**
```
프론트엔드 → 백엔드 → OpenAI API
            ↑
      API 키는 서버에만 존재
      (사용자가 볼 수 없음)
```

### 2. 사용량 제한
- 사용자별 요청 횟수 제한
- API 비용 관리
- 악용 방지

### 3. 데이터 저장
- 사용자 정보 (데이터베이스)
- 궁합 결과 히스토리
- 프로필 관리

### 4. 성능 최적화
- 동일한 결과 캐싱
- 응답 시간 단축
- 서버 부하 분산

---

## 📋 백엔드 API 엔드포인트 목록

### 1. AI 조언 API
- **URL**: `POST /api/ai-advice`
- **역할**: 궁합 결과를 AI에게 전달하여 조언 생성
- **입력**: 궁합 점수, 살 분석, 사용자 정보
- **출력**: AI 조언, 팁, 요약

### 2. 인증 API
- **로그인**: `POST /api/auth/login`
- **회원가입**: `POST /api/auth/signup`
- **프로필 조회**: `GET /api/auth/profile`
- **프로필 업데이트**: `PUT /api/auth/profile`

---

## 🔧 백엔드 서버 실행 방법

### 1. 백엔드 폴더로 이동
```bash
cd backend
```

### 2. 패키지 설치 (처음 한 번만)
```bash
npm install
```

### 3. 환경 변수 설정 (선택)
`backend/.env` 파일 생성:
```env
PORT=3000
OPENAI_API_KEY=sk-your-key-here
```

### 4. 서버 실행
```bash
npm start
```

서버가 실행되면:
```
🚀 백엔드 서버가 http://localhost:3000 에서 실행 중입니다.
```

---

## 💡 백엔드 vs 프론트엔드

| 구분 | 프론트엔드 | 백엔드 |
|------|-----------|--------|
| **위치** | 사용자 브라우저/앱 | 서버 컴퓨터 |
| **역할** | 화면 표시, 사용자 입력 | 데이터 처리, API 호출 |
| **코드 위치** | `app/`, `components/` | `backend/` |
| **접근** | 누구나 볼 수 있음 | 서버에서만 실행 |
| **API 키** | ❌ 노출 위험 | ✅ 안전하게 보관 |

---

## 🎯 현재 상태

### 구현된 기능
- ✅ AI 조언 API (OpenAI 연동)
- ✅ 인증 API 기본 구조 (예시)
- ✅ CORS 설정
- ✅ 에러 처리

### 아직 구현 안 된 부분 (TODO)
- ⏳ 실제 데이터베이스 연동
- ⏳ JWT 토큰 인증
- ⏳ 사용량 제한
- ⏳ 결과 캐싱
- ⏳ 로깅 시스템

---

## 📝 요약

**백엔드 서버는:**
1. **보안**: API 키를 안전하게 보관
2. **중개자**: 프론트엔드와 외부 API 사이 연결
3. **처리자**: 데이터 검증, 변환, 저장
4. **제어자**: 사용량 제한, 비용 관리

**현재 프로젝트에서:**
- 프론트엔드: 사용자가 보는 화면 (Expo/React Native)
- 백엔드: 서버에서 돌아가는 API 서버 (Node.js/Express)
- 연결: 프론트엔드가 백엔드 API를 호출하여 통신

